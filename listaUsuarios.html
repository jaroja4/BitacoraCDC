<!DOCTYPE html>
<html lang="es">

<head>
  <!-- check User session -->
  <script src="assets/js/jquery/dist/jquery.min.js"></script>
  <script src="assets/js/session.js"></script>
  <script>
    Session.Check();
  </script>
  <!-- /End check -->
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="icon" href="images/favicon.ico" type="image/ico" /> -->

  <title>Bitácora CDC | DTI</title>

  <!-- Bootstrap -->
  <link href="vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="vendors/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- Datatables -->
  <link href="vendors/datatables.net/datatables.min.css" rel="stylesheet">
  <link href="vendors/datatables.net/DataTables-1.10.18/css/dataTables.bootstrap.min.css" rel="stylesheet">
  <!-- SweetAlert -->
  <link href="vendors/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">
  <!-- RangePicker -->
  <link href="vendors/daterangepicker/daterangepicker.css" rel="stylesheet">
  <!-- NProgress -->
  <link href="vendors/nprogress/nprogress.css" rel="stylesheet">
  <!-- bootstrap-daterangepicker -->
  <link href="vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
  <!-- Custom Theme Style -->
  <link href="assets/css/custom.min.css" rel="stylesheet">
  <link href="assets/css/modal_accordion_formulario_ingreso.css" rel="stylesheet">

  <link href='vendors/select2/css/select2.css' rel='stylesheet' type='text/css'>



</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">
          <div class="navbar nav_title" style="border: 0;">
            <a href="index.html" class="site_title"><i class="fa fa-bullhorn"></i> <span>Centros de Datos Corporativos
              </span></a>
          </div>

          <div class="clearfix"></div>

          <!-- menu profile quick info -->
          <div class="profile clearfix">
            <div class="profile_pic">
              <img src="images/LogoICESmall.png" alt="..."
                style="width:70px;height:70px;border-radius:50%;margin-top:10%">
            </div>
            <div class="profile_info">
              <span><span>Bienvenido,</span></span>
              <h2>Usuario de Seguridad</h2>
            </div>
          </div>
          <!-- /menu profile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
            <div class="menu_section">
              <h3 id='call_userName'></h3>
              <ul id="menubox" class="nav side-menu">

              </ul>
            </div>
          </div>
          <!-- /sidebar menu -->
        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">
        <div class="nav_menu">
          <nav>
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a id="call_name" href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                  aria-expanded="false">
                  <img src="images/img.png" alt="">Usuario de Seguridad
                  <span class=" fa fa-angle-down"></span>
                </a>
                <ul class="dropdown-menu dropdown-usermenu pull-right">
                  <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Salir</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col" role="main">
        <div class="">
          <div class="page-title">
            <div class="title_left">
              <h3>Gestión de Usuarios <small></small></h3>
            </div>

            <!-- <div class="title_right">
                  <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Buscar en formularios...">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">Buscar</button>
                      </span>
                    </div>
                  </div>
                </div> -->
          </div>

          <div class="clearfix"></div>

          <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div class="x_panel">
                <div class="x_title">
                  <button id="btn_abrirModal_NuevoUsuario" type="button" class="btn btn-primary">Crear Nuevo
                    Usuario</button>
                  <div class="nav navbar-right panel_toolbox">

                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">

                  <div class="container">
                    <ul class="nav nav-tabs">
                      <li class="active">
                        <a href="#tab_usuarios" data-toggle="tab">Usuarios</a>
                      </li>
                      <li><a href="#tab_responsables" data-toggle="tab">Responsables</a>
                      </li>
                      <li><a href="#tab_visitantes" data-toggle="tab">Visitantes</a>
                      </li>
                      <li><a href="#tab_autorizadores" data-toggle="tab">Autorizadores</a>
                      </li>
                    </ul>

                    <div class="tab-content ">
                      <br>
                      <div class="tab-pane active" id="tab_usuarios">
                        <div class="table-responsive">
                          <table id="tb_usuarios" class="table table-striped jambo_table bulk_action">
                            <thead>
                            </thead>

                            <tbody>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <div class="tab-pane" id="tab_responsables">
                        <div class="table-responsive">
                          <table id="tb_responsables" class="table table-striped jambo_table bulk_action">
                            <thead>
                            </thead>

                            <tbody>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <div class="tab-pane" id="tab_visitantes">
                        <div class="table-responsive">
                          <table id="tb_visitantes" class="table table-striped jambo_table bulk_action">
                            <thead>
                            </thead>

                            <tbody>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <div class="tab-pane" id="tab_autorizadores">
                        <div class="table-responsive">
                          <table id="tb_autorizadores" class="table table-striped jambo_table bulk_action">
                            <thead>
                            </thead>

                            <tbody>
                            </tbody>
                          </table>
                        </div>
                      </div>

                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /page content -->


      <!-- footer content -->
      <footer>
        <div class="pull-right">
          Operaciones TI - DTI - Instituto Costarricense de Electricidad
        </div>
        <div class="clearfix"></div>
      </footer>
      <!-- /footer content -->
    </div>
  </div>

  <!--Modal Crear usuario -->
  <div class="modal fade" id="modal_NuevoUsuario">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Crear Nuevo Usuario</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">

          <form class="form-horizontal" role="form">
            <div class="form-group">
              <label for="inp_nombre" class="col-sm-2 control-label">Nombre Completo</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inp_nombre" placeholder="Ingrese Nombre Completo">
              </div>
            </div>
            <div class="form-group">
              <label for="inp_identificacion" class="col-sm-2 control-label">Identificación</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inp_identificacion"
                  placeholder="Ingrese el numero de Identificación">
              </div>
            </div>
            <div class="form-group">
              <label for="inp_usuario" class="col-sm-2 control-label">Usuario de Red</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inp_usuario" placeholder="Ingrese el Usuario de Red">
              </div>
            </div>
            <div class="form-group">
              <label for="inp_identificacion" class="col-sm-2 control-label">Correo Electrónico</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inp_correo" placeholder="Ingrese el correo electrónico">
              </div>
            </div>
            <div class="form-group">
              <label for="inp_empresa" class="col-sm-2 control-label">Dependencia o Empresa</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inp_empresa"
                  placeholder="Ingrese la empresa o dependencia a la que pertenece">
              </div>
            </div>
            <div class="form-group">
              <label for="inp_rol" class="col-sm-2 control-label">Rol:</label>
              <div class="col-sm-10">
                <select id="inp_rol" class="form-control js-example-responsive">
                </select>
              </div>
            </div>
          </form>
          <hr>
          <form class="form-horizontal">
            <div class="form-group">
              <label for="inp_usuario" class="col-sm-2 control-label">Buscar en LDAP:</label>
              <div class="col-sm-4">
                <select class="form-control" id="sel_tipoFiltro" name="tipoFiltro">
                  <option value='mail'>Correo</option>
                  <option value='samAccountName'>Usuario</option>
                  <option value='cn'>Nombre</option>
                  <option value='description'>Cedula</option>
                </select>
              </div>
              <div class="col-sm-4">
                <input type="text" class="form-control" id="inp_searchValue" name="searchValue"
                  placeholder="Ingrese el Valor a Buscar">
              </div>
              <div class="col-sm-1">
                <button id="btn_buscarLDAP" class="btn btn-default">Buscar</button>
              </div>
            </div>
          </form>
          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="btn_guardarUsuario">Agregar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="assets/js/jquery/dist/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="vendors/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- JS dataTables -->
  <script src="vendors/datatables.net/DataTables-1.10.18/js/jquery.dataTables.min.js"></script>
  <script src="vendors/datatables.net/DataTables-1.10.18/js/dataTables.bootstrap.min.js"></script>
  <!-- NProgress -->
  <script src="vendors/nprogress/nprogress.js"></script>
  <!-- bootstrap-progressbar -->
  <script src="vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
  <!-- Seleect2 -->
  <script src='vendors/select2/js/select2.js'></script>
  <!-- Moment -->
  <script src="vendors/moment/moment.min.js"></script>
  <script src="vendors/moment/locale/es.js"></script>
  <!-- SweetAlert2 -->
  <script src="vendors/sweetalert2/dist/sweetalert2.js"></script>
  <!-- bootstrap-daterangepicker -->
  <script src="vendors/daterangepicker/daterangepicker.min.js"></script>
  <!-- Custom Theme Scripts -->
  <script src="assets/js/custom.js"></script>
  <script src="assets/js/usuario.js"></script>
  <script src="assets/js/rol.js"></script>

</body>

</html>

<script>

  var update = false;

  $(document).ready(function () {

    usuario.responsables_ReadAll_list;
    usuario.usuarios_ReadAll_list;
    usuario.visitantes_ReadAll_list;
    usuario.autorizadores_ReadAll_list;
    usuario.autorizadores_ReadAll_list;
    rol.readAll;

    $('#inp_rol').select2({
      width: "100%",
      multiple: true,
      placeholder: 'Seleccione Rol...',
      closeOnSelect: false
    });

    $("#btn_abrirModal_NuevoUsuario").click(function () {
      usuario.clearModalNuevoUsuario;
      update = false;
      $("#btn_guardarUsuario").text("Crear");
      $("#modal_NuevoUsuario").modal("toggle");
    });

    $("#btn_guardarUsuario").click(function () {
      usuario.nombre = $("#inp_nombre").val();
      usuario.cedula = $("#inp_identificacion").val();
      usuario.correo = $("#inp_correo").val();
      usuario.usuario = $("#inp_usuario").val();
      usuario.empresa = $("#inp_empresa").val();
      usuario.rol = $("#inp_rol").select2("val");

      update ? usuario.update : usuario.create;
    });

    $("#btn_buscarLDAP").click(function () {
      event.preventDefault();

      var values = { tipoFiltro: "", searchValue: "" };
      values.tipoFiltro = $("#sel_tipoFiltro").val();
      values.searchValue = $("#inp_searchValue").val();

      var miAccion = "BuscarLDAP";
      $.ajax({
        type: "POST",
        url: "class/checkLDAP.php",
        data: {
          action: miAccion,
          obj: JSON.stringify(values)
        }
      })
        .done(function (e) {
          var data = JSON.parse(e);
          if (data) {
            $("#inp_nombre").val(data.nombre);
            $("#inp_identificacion").val(data.cedula);
            $("#inp_correo").val(data.email);
            $("#inp_usuario").val(data.usuario);
            $("#inp_empresa").val(data.physicaldeliveryofficename);
            usuario.SwalAlert('success', 'Usuario Encontrado');
          }
          else {
            usuario.SwalAlert('error', 'Sin Resultados');
          }
        })

    });

    $('#tb_usuarios tbody').on('click', 'tr', function () {
      update = true;
      usuario.id = $('#tb_usuarios').DataTable().row(this).data().id;
      usuario.nombre = $('#tb_usuarios').DataTable().row(this).data().nombre;
      usuario.usuario = $('#tb_usuarios').DataTable().row(this).data().usuario;
      usuario.cedula = $('#tb_usuarios').DataTable().row(this).data().cedula;
      usuario.correo = $('#tb_usuarios').DataTable().row(this).data().correo;
      usuario.empresa = $('#tb_usuarios').DataTable().row(this).data().empresa;

      rol.idUsuario = usuario.id;
      usuario.rol = rol.loadbyUser;

      $("#inp_nombre").val(usuario.nombre);
      $("#inp_identificacion").val(usuario.cedula);
      $("#inp_correo").val(usuario.correo);
      $("#inp_usuario").val(usuario.usuario);
      $("#inp_empresa").val(usuario.empresa);

      if (usuario.cedula != null) {
        $('#sel_tipoFiltro').val("description").change();
        $("#inp_searchValue").val(usuario.cedula);
      } else if (usuario.usuario != "" && usuario.usuario != null) {
        $('#sel_tipoFiltro').val("samAccountName").change();
        $("#inp_searchValue").val(usuario.usuario);
      } else if (usuario.correo != null) {
        $('#sel_tipoFiltro').val("mail").change();
        $("#inp_searchValue").val(usuario.correo);
      }

      $("#btn_guardarUsuario").text("Actualizar");
      $("#modal_NuevoUsuario").modal("toggle");
    });


  })
</script>